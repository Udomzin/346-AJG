<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskSplit - Create Project</title>
    
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="create_project.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="page-wrapper">
        <div class="dashboard-container form-view-container"> 
            
            <header class="form-header">
                <button class="icon-btn back-btn" title="Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 class="header-title">Create Project</h1>
                <div style="width: 36px; height: 36px;"></div> 
            </header>

            <main class="main-content form-content">
                <form id="project-form" class="project-form">
                    
                    <div class="input-group">
                        <label for="projectName">
                            <i class="fas fa-clipboard-list"></i> Project Name
                        </label>
                        <input type="text" id="projectName" placeholder="e.g., DTI326 Mobile App" required>
                    </div>

                    <div class="input-group">
                        <label for="description">
                            <i class="fas fa-file-alt"></i> Description
                        </label>
                        <textarea id="description" placeholder="Describe your workspace..."></textarea>
                    </div>
                    
                    <div class="input-group member-control-group">
                        <label for="maxMembers">
                            <i class="fas fa-user-friends"></i> Max Members
                        </label>
                        <div class="member-control">
                            <button type="button" class="control-btn minus-btn"><i class="fas fa-minus"></i></button>
                            <input type="number" id="maxMembers" value="4" min="1" max="100" readonly>
                            <button type="button" class="control-btn plus-btn"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label><i class="fas fa-envelope"></i> Invite Members (Optional)</label>
                        <div id="email-list" style="margin-bottom: 10px;"></div>
                        <div style="display: flex; gap: 10px;">
                             <input 
                                 type="email" 
                                 id="inviteEmail" 
                                 placeholder="Enter member email"
                                 style="flex: 1; padding: 12px; border-radius: 8px; background: #2d2d2d; border: 1px solid #444; color: white;"
                             >
                             <button 
                                type="button" 
                                id="addEmailBtn"
                                style="padding: 12px 20px; background: #55ac40; border: none; border-radius: 8px; color: white; cursor: pointer;"
                             >
                                <i class="fas fa-plus"></i> Add
                             </button>
                        </div>
                        <input type="hidden" id="membersInput" name="members">
                    </div>

                    <div class="form-footer-action">
                        <button type="submit" class="btn-full-width">Create Project</button>
                    </div>
                    
                </form>
            </main>

        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Member control
            const minusBtn = document.querySelector('.minus-btn');
            const plusBtn = document.querySelector('.plus-btn');
            const memberInput = document.getElementById('maxMembers');
            
            minusBtn.addEventListener('click', () => {
                let currentVal = parseInt(memberInput.value);
                if (currentVal > parseInt(memberInput.min)) {
                    memberInput.value = currentVal - 1;
                }
            });

            plusBtn.addEventListener('click', () => {
                let currentVal = parseInt(memberInput.value);
                if (currentVal < parseInt(memberInput.max)) {
                    memberInput.value = currentVal + 1;
                }
            });
            
            // ปุ่ม Back
            document.querySelector('.back-btn').addEventListener('click', () => {
                window.history.back();
            });

            // Add Email
            const addEmailBtn = document.getElementById('addEmailBtn');
            const inviteEmail = document.getElementById('inviteEmail');
            const emailList = document.getElementById('email-list');
            let emails = [];

            addEmailBtn.addEventListener('click', () => {
                const email = inviteEmail.value.trim();
                if (!email) {
                    alert('กรุณากรอกอีเมล');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('รูปแบบอีเมลไม่ถูกต้อง');
                    return;
                }

                // เพิ่มอีเมลลงใน array
                emails.push(email);

                // สร้าง div แสดงอีเมล
                const emailDiv = document.createElement('div');
                emailDiv.textContent = email;
                emailDiv.style.padding = "5px 10px";
                emailDiv.style.background = "#444";
                emailDiv.style.color = "white";
                emailDiv.style.borderRadius = "5px";
                emailDiv.style.marginBottom = "5px";
                emailDiv.style.fontSize = "14px";

                // ปุ่มลบ
                const removeBtn = document.createElement('button');
                removeBtn.textContent = "×";
                removeBtn.style.marginLeft = "10px";
                removeBtn.style.background = "red";
                removeBtn.style.border = "none";
                removeBtn.style.color = "white";
                removeBtn.style.cursor = "pointer";
                removeBtn.style.borderRadius = "50%";
                removeBtn.style.width = "20px";
                removeBtn.style.height = "20px";
                removeBtn.addEventListener('click', () => {
                    emailList.removeChild(emailDiv);
                    emails = emails.filter(e => e !== email);
                });

                emailDiv.appendChild(removeBtn);
                emailList.appendChild(emailDiv);

                inviteEmail.value = "";
            });

            // Submit form
            const projectForm = document.getElementById('project-form');
            projectForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const projectName = document.getElementById('projectName').value.trim();
                const description = document.getElementById('description').value.trim();
                const maxMembers = document.getElementById('maxMembers').value;

                if (!projectName) {
                    alert('กรุณากรอกชื่อ Project');
                    return;
                }

                // เก็บอีเมลทั้งหมดใน hidden input
                document.getElementById('membersInput').value = emails.join(',');

                const token = localStorage.getItem('currentUserToken') || sessionStorage.getItem('currentUserToken');

                let projects = JSON.parse(localStorage.getItem('projects')) || [];

                projects.push({
                    name: projectName,
                    description: description,
                    maxMembers: maxMembers,
                    ownerToken: token,
                    members: emails
                });

                localStorage.setItem('projects', JSON.stringify(projects));

                window.location.href = 'dashboard.html';
            });
        });
    </script>
</body>
</html>