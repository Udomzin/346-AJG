<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskSplit - Login</title>
    
    <!-- เชื่อมต่อ Font Awesome สำหรับไอคอน -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- เชื่อมต่อไฟล์ CSS หลัก -->
    <link rel="stylesheet" href="login.css">
</head>
<body>
    <!-- คอนเทนเนอร์หลัก -->
    <div class="app-container">
        <div class="login-card">
            
            <!-- ====================================
                 ส่วนโลโก้
                 ==================================== -->
            <div class="logo-section">
                <!-- ไอคอนโลโก้ -->
                <div class="logo-icon">
                    <i class="fas fa-user-friends"></i>
                </div>
                <!-- ชื่อแอป -->
                <h1>TaskSplit</h1>
            </div>

            <!-- ====================================
                 ข้อความต้อนรับ
                 ==================================== -->
            <div class="welcome-text">
                <h2>Welcome Back</h2>
                <p>Sign in to continue</p>
            </div>

            <!-- ====================================
                 ฟอร์มล็อกอิน
                 ==================================== -->
            <form class="login-form" id="loginForm">
                <!-- ช่องกรอกอีเมล -->
                <input 
                    type="email" 
                    id="email" 
                    placeholder="you@example.com" 
                    required
                >
                
                <!-- ช่องกรอกรหัสผ่าน -->
                <input 
                    type="password" 
                    id="password" 
                    placeholder="Password" 
                    required
                >
                
                <!-- ตัวเลือก Remember Me -->
                <div class="options">
                    <div class="remember-me">
                        <input type="checkbox" id="remember">
                        <label for="remember">Remember me</label>
                    </div>
                </div>

                <!-- ปุ่มล็อกอิน -->
                <button type="submit" class="btn-primary">Sign In</button>
            </form>

            <!-- ====================================
                 ลิงก์ไปหน้าสมัครสมาชิก
                 ==================================== -->
            <div class="signup-link">
                Don't have an account? <a href="signup.html">Sign Up</a>
            </div>
        </div>
    </div>

    <!-- ====================================
         JavaScript สำหรับจัดการการล็อกอิน
         ==================================== -->
    <script>
        // ====================================
        // เริ่มทำงานเมื่อโหลดหน้าเว็บเสร็จ
        // ====================================
        document.addEventListener('DOMContentLoaded', () => {
            
            // ====================================
            // 1. ดึง Elements จาก DOM
            // ====================================
            const loginForm = document.getElementById('loginForm');
            const rememberCheckbox = document.getElementById('remember');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');

            // ====================================
            // 2. ตรวจสอบว่ามีข้อมูล Remember Me บันทึกไว้หรือไม่
            // ====================================
            const savedEmail = localStorage.getItem('rememberedEmail');
            const savedPassword = localStorage.getItem('rememberedPassword');

            // ถ้ามีข้อมูลบันทึกไว้ ให้เติมอัตโนมัติ
            if (savedEmail && savedPassword) {
                emailInput.value = savedEmail;
                passwordInput.value = savedPassword;
                rememberCheckbox.checked = true;
            }

            // ====================================
            // 3. จัดการการ Submit ฟอร์ม
            // ====================================
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault(); // ป้องกันการ reload หน้า

                // ดึงข้อมูลจากฟอร์ม
                const email = emailInput.value.trim();
                const password = passwordInput.value;

                // ตรวจสอบว่ากรอกข้อมูลครบหรือไม่
                if (!email || !password) {
                    alert('Please fill in all fields');
                    return;
                }

                // ====================================
                // 4. ตรวจสอบข้อมูลผู้ใช้
                // ====================================
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const user = users.find(u => u.email === email && u.password === password);

                // ถ้าไม่พบผู้ใช้หรือรหัสผ่านผิด
                if (!user) {
                    alert('Invalid email or password');
                    return;
                }

                // ====================================
                // 5. จัดการ Remember Me
                // ====================================
                if (rememberCheckbox.checked) {
                    // บันทึกข้อมูลไว้ใน localStorage
                    localStorage.setItem('rememberedEmail', email);
                    localStorage.setItem('rememberedPassword', password);
                    localStorage.setItem('currentUserToken', user.token);
                } else {
                    // ลบข้อมูล Remember Me
                    localStorage.removeItem('rememberedEmail');
                    localStorage.removeItem('rememberedPassword');
                    // ใช้ sessionStorage แทน (หายเมื่อปิด browser)
                    sessionStorage.setItem('currentUserToken', user.token);
                }

                // ====================================
                // 6. ล็อกอินสำเร็จ
                // ====================================
                alert('Login successful!');
                window.location.href = 'dashboard.html';
            });

            // ====================================
            // 7. ลบข้อมูล Remember Me เมื่อยกเลิกติ๊ก
            // ====================================
            rememberCheckbox.addEventListener('change', () => {
                if (!rememberCheckbox.checked) {
                    localStorage.removeItem('rememberedEmail');
                    localStorage.removeItem('rememberedPassword');
                }
            });
        });
    </script>
</body>
</html>